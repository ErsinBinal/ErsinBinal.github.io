<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bartender | Convivium</title>
    <meta name="description" content="Interaktif kokteyl onerici - ruh halinize gore icecek onerileri.">
    <meta name="author" content="Ersin Binal">
    <link rel="canonical" href="https://ersinbinal.github.io/Bartender.html">

    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self';">

    <!-- OpenGraph -->
    <meta property="og:site_name" content="Convivium">
    <meta property="og:title" content="Bartender | Convivium">
    <meta property="og:description" content="Interaktif kokteyl onerici.">
    <meta property="og:type" content="website">

    <!-- PWA -->
    <meta name="theme-color" content="#ff9900">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/svg+xml" href="/assets/icons/icon.svg">
    
    <style>
        /* ============================
           1. CYBERPUNK BASE & OKUNABİLİRLİK
           ============================ */
        :root {
            --bg: #050505;
            --surface: #0e0e0e;
            --primary: #ff9900; /* Amber */
            --text-main: #e0e0e0; 
            --text-muted: #999999;
            --border: rgba(255, 255, 255, 0.15);
            --font: 'Courier New', Courier, monospace;
        }

        * { box-sizing: border-box; }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            font-family: var(--font);
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
        }

        body::before {
            content: ""; position: fixed; inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 3px;
            pointer-events: none; z-index: 99; opacity: 0.2;
        }

        .container {
            width: 90%; max-width: 500px; text-align: center;
            position: relative; z-index: 10;
            padding-bottom: 40px;
        }

        nav { position: absolute; top: 20px; left: 20px; }
        nav a { color: var(--text-muted); text-decoration: none; font-size: 0.8rem; text-transform: uppercase; border:1px solid #333; padding:6px 12px; transition:0.3s; background: #000; }
        nav a:hover { color: var(--primary); border-color:var(--primary); }

        /* ============================
           2. SAHNE ALANI
           ============================ */
        .stage-area {
            height: 280px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            position: relative;
            background: radial-gradient(circle at bottom, #1a1a1a, #000 80%);
            margin-bottom: 20px;
            border-bottom: 4px solid #333;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .bar-background {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
            display: flex; justify-content: space-between; padding: 20px 10px 0 10px;
            opacity: 0.4; filter: blur(0.5px);
        }
        .shelf-block { width: 35%; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; padding-bottom: 90px; }
        .shelf-line { width: 100%; height: 4px; background: #333; margin-bottom: 5px; }
        .bottles-row { display: flex; justify-content: space-around; align-items: flex-end; height: 60px; margin-bottom: -4px; z-index: 1; }
        .bottle { background: rgba(255,255,255,0.05); border: 1px solid #555; position: relative; }
        .bottle::after { content:""; position: absolute; top:-5px; left: 50%; transform: translateX(-50%); width: 40%; height: 5px; background: #444; }
        .b-tall { width: 14px; height: 50px; border-radius: 2px; }
        .b-fat { width: 20px; height: 35px; border-radius: 5px; }
        .b-sq { width: 18px; height: 45px; border-radius: 0; }
        .wall-texture { position: absolute; top:0; left:0; width:100%; height:100%; background-image: linear-gradient(#111 1px, transparent 1px), linear-gradient(90deg, #111 1px, transparent 1px); background-size: 20px 20px; z-index: -1; opacity: 0.3; }

        .bartender-layer { position: absolute; bottom: 0; width: 100%; height: 100%; display: flex; align-items: flex-end; justify-content: center; transition: opacity 0.5s; z-index: 5; }
        .bar-counter { position: absolute; bottom: 0; width: 100%; height: 15px; background: linear-gradient(to bottom, #333, #111); border-top: 3px solid var(--primary); z-index: 6; }
        .cyber-tender { width: 110px; height: 170px; position: relative; bottom: 15px; display: flex; flex-direction: column; align-items: center; animation: idleBreathe 4s ease-in-out infinite; filter: drop-shadow(0 0 10px rgba(0,0,0,0.8)); }
        .tender-head { width: 55px; height: 45px; background: linear-gradient(135deg, #444, #222); border: 2px solid var(--primary); border-radius: 8px; position: relative; }
        .tender-eyes { position: absolute; top: 15px; left: 10px; width: 30px; height: 4px; background: var(--primary); animation: eyeScan 4s infinite ease-in-out; }
        .tender-neck { width: 20px; height: 10px; background: #333; margin-top: -2px; z-index: -1; }
        .tender-body { width: 100px; height: 115px; background: radial-gradient(circle at center, #333, #111); border: 1px solid #444; border-top: none; border-radius: 20px 20px 0 0; position: relative; display: flex; justify-content: center; padding-top: 20px; }
        .tender-core { width: 36px; height: 36px; background: rgba(255,153,0,0.1); border: 1px solid var(--primary); border-radius: 50%; animation: corePulse 2s infinite; }

        .shaker-layer { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%) translateY(20px); opacity: 0; transition: all 0.5s; z-index: 7; }
        .shaker-container { width: 80px; height: 140px; position: relative; transform-origin: bottom center; }
        .shaker-body { width: 100%; height: 75%; background: linear-gradient(135deg, #555, #222); border-radius: 5px 5px 25px 25px; border: 2px solid #888; position: absolute; bottom: 0; }
        .shaker-cap { width: 100%; height: 25%; background: linear-gradient(135deg, #666, #333); border-radius: 15px 15px 5px 5px; border: 2px solid #999; border-bottom: 1px solid #222; position: absolute; top: 0; }
        .shaker-top { width: 40%; height: 15px; background: #555; position: absolute; top: -15px; left: 30%; border-radius: 5px 5px 0 0; border: 2px solid #888; }
        .is-shaking { animation: shakeHard 0.15s infinite; }

        .presentation-layer { position: absolute; width: 100%; height: 100%; bottom: 10px; display: flex; align-items: flex-end; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.5s; z-index: 8; }
        .glass-svg { width: 140px; height: 140px; fill: none; stroke: #ccc; stroke-width: 2; overflow: visible; position: relative; z-index: 2; filter: drop-shadow(0 0 5px rgba(255,255,255,0.2)); }
        .liquid-stream { position: absolute; top: 0px; width: 8px; height: 0; background: var(--primary); box-shadow: 0 0 15px var(--primary); z-index: 1; transition: height 0.5s; border-radius: 4px; }
        .liquid-fill { fill: var(--primary); opacity: 0; transition: opacity 1s, fill 0.5s; filter: drop-shadow(0 0 8px var(--primary)); }

        @keyframes idleBreathe { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-2px); } }
        @keyframes eyeScan { 0%, 100% { width: 30px; left: 10px; opacity: 1; } 50% { width: 10px; left: 20px; opacity: 0.5; } }
        @keyframes corePulse { 0%, 100% { opacity: 0.5; transform: scale(1); } 50% { opacity: 1; transform: scale(1.1); } }
        @keyframes shakeHard { 0% { transform: rotate(0deg); } 25% { transform: rotate(-15deg); } 75% { transform: rotate(15deg); } 100% { transform: rotate(0deg); } }

        /* ============================
           4. UI ELEMANLARI
           ============================ */
        .dialogue-card { background: var(--surface); border: 1px solid var(--border); border-left: 4px solid var(--primary); padding: 20px; margin-bottom: 20px; text-align: left; min-height: 80px; }
        .dialogue-header { font-size: 0.55rem; color: rgba(255, 255, 255, 0.4); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; display: block; }
        .typing-text { font-size: 1rem; line-height: 1.5; white-space: pre-wrap; color: var(--text-main); }

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; opacity: 0; animation: fadeIn 0.5s forwards; }
        .option-btn { background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: #ccc; padding: 15px; cursor: pointer; font-family: inherit; text-transform: uppercase; font-size: 0.85rem; transition: 0.2s; }
        .option-btn:hover { border-color: var(--primary); color: #fff; background: rgba(255,153,0,0.1); transform: translateY(-2px); }
        
        .result-card { display: none; border: 1px solid var(--primary); background: #080808; margin-top: 20px; animation: slideUp 0.5s ease; text-align: left; }
        .result-head { background: var(--primary); color: #000; padding: 12px 15px; font-weight: bold; display: flex; justify-content: space-between; font-size: 1.1rem; }
        .result-body { padding: 20px; }
        
        .section-title { color: var(--primary); font-size: 0.8rem; letter-spacing: 1px; display: block; margin-bottom: 8px; margin-top: 20px; font-weight: bold; }
        .recipe-list { color: var(--text-main); margin: 0; padding-left: 0; font-size: 0.95rem; line-height: 1.6; list-style: none; }
        .recipe-list li { margin-bottom: 6px; border-bottom: 1px dashed #333; padding-bottom: 3px; display: flex; justify-content: space-between; }
        .recipe-list li span:last-child { color: var(--primary); font-weight: bold; } 

        .playlist-box { background: rgba(255,255,255,0.03); border: 1px solid #333; padding: 15px; margin-top: 10px; border-radius: 4px; }
        .playlist-item { display: flex; align-items: center; color: #bbb; font-size: 0.85rem; margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #222; }
        .playlist-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .icon-music { margin-right: 10px; color: var(--primary); font-size: 1rem; }

        .btn-full { display: block; width: 100%; text-align: center; padding: 14px; margin-top: 15px; text-decoration: none; border: 1px solid var(--border); color: #ccc; transition: 0.3s; font-size: 0.9rem; text-transform: uppercase; background: #111; }
        .btn-full.highlight { border-color: var(--primary); color: var(--primary); font-weight: bold; }
        .btn-full:hover { background: var(--primary); color: #000; }

        @keyframes fadeIn { to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @media (max-width: 600px) { .options-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <nav><a href="index.html">← GERİ</a></nav>

    <div class="container">
        <div class="stage-area">
            <div class="wall-texture"></div>
            <div class="bar-background">
                <div class="shelf-block"><div class="bottles-row"><div class="bottle b-tall"></div><div class="bottle b-fat"></div><div class="bottle b-sq"></div></div><div class="shelf-line"></div><div class="bottles-row"><div class="bottle b-fat"></div><div class="bottle b-sq"></div></div><div class="shelf-line"></div></div>
                <div class="shelf-block"><div class="bottles-row"><div class="bottle b-sq"></div><div class="bottle b-tall"></div></div><div class="shelf-line"></div><div class="bottles-row"><div class="bottle b-tall"></div><div class="bottle b-fat"></div><div class="bottle b-sq"></div></div><div class="shelf-line"></div></div>
            </div>
            <div id="bartender-layer" class="bartender-layer"><div class="cyber-tender"><div class="tender-head"><div class="tender-eyes"></div></div><div class="tender-neck"></div><div class="tender-body"><div class="tender-core"></div></div></div><div class="bar-counter"></div></div>
            <div id="shaker-layer" class="shaker-layer"><div id="shaker" class="shaker-container"><div class="shaker-top"></div><div class="shaker-cap"></div><div class="shaker-body"></div></div></div>
            <div id="presentation-layer" class="presentation-layer"><div id="stream" class="liquid-stream"></div><svg id="glass-icon" class="glass-svg" viewBox="0 0 100 100"><path id="glass-path" d="" fill="none" stroke="currentColor" stroke-width="2"/><path id="liquid-path" class="liquid-fill" d="" /></svg></div>
        </div>

        <div class="dialogue-card">
            <span class="dialogue-header">Cyber-Tender v5.0 [Matrix Core]</span>
            <div id="dialogue-text" class="typing-text"></div>
        </div>

        <div id="options-area" class="options-grid"></div>

        <div id="result-card" class="result-card">
            <div class="result-head">
                <span id="drink-title"></span>
                <span>%100 MATCH</span>
            </div>
            <div class="result-body">
                <p id="drink-desc" style="color:#bbb; font-style:italic; margin-bottom:15px; font-size:1rem;"></p>
                <p id="drink-prep" style="color:#999; font-size:0.9rem; margin-bottom:20px; line-height:1.5; border-left:2px solid var(--primary); padding-left:12px;"></p>
                
                <div class="section-title">> İÇERİK & ÖLÇEKLER:</div>
                <ul id="drink-recipe" class="recipe-list"></ul>

                <div class="section-title">> VIBE PLAYLIST:</div>
                <div id="playlist-container" class="playlist-box"></div>
                
                <a id="price-btn" href="#" target="_blank" class="btn-full highlight">Fiyat Araştırması</a>
                <button onclick="location.reload()" class="btn-full">Yeniden Başlat</button>
            </div>
        </div>
    </div>

    <script>
        const glassPaths = {
            martini: { path: "M10,10 L50,60 L90,10 Z M50,60 L50,95 M30,95 L70,95", fill: "M15,15 L50,55 L85,15 Z" },
            rocks: { path: "M15,20 L20,90 L80,90 L85,20 Z", fill: "M22,85 L78,85 L82,30 L18,30 Z" },
            highball: { path: "M20,10 L25,90 L75,90 L80,10 Z", fill: "M26,85 L74,85 L78,20 L22,20 Z" },
            wine: { path: "M25,10 Q25,60 50,60 Q75,60 75,10 Z M50,60 L50,95 M30,95 L70,95", fill: "M28,20 Q28,55 50,55 Q72,55 72,20 Z" },
            shot: { path: "M30,30 L35,90 L65,90 L70,30 Z", fill: "M36,85 L64,85 L68,35 L32,35 Z" }
        };

        // --- PDF MATRİS VE REÇETE VERİTABANI ---
        const drinksDB = {
            // SAKİN
            "APEROL SPRITZ": { type: "wine", color: "#e67e22", desc: "Hafif, köpüklü ve turuncu. İtalyan klasiği.", prep: "Büyük şarap bardağını buzla doldurun. Malzemeleri ekleyip hafifçe karıştırın.", recipe: ["Prosecco|9cl", "Aperol|6cl", "Soda|3cl"], playlist: ["La Dolce Vita - Nino Rota", "Sunny - Boney M", "Volare - Gipsy Kings", "Sway - Dean Martin", "It's Now or Never - Elvis"], query: "aperol fiyat" },
            "WHISKEY SOUR": { type: "rocks", color: "#f1c40f", desc: "Viskinin en ipeksi hali.", prep: "Malzemeleri buzsuz çalkalayın (dry shake), sonra buzla çalkalayıp süzün.", recipe: ["Burbon|6cl", "Limon Suyu|3cl", "Şeker Şurubu|2cl", "Yumurta Akı|Opsiyonel"], playlist: ["Take Five - Dave Brubeck", "Feeling Good - Nina Simone", "Summertime - Ella Fitzgerald", "Unchain My Heart - Ray Charles", "What a Wonderful World - Louis Armstrong"], query: "viski fiyat" },
            "AMERICANO": { type: "highball", color: "#c0392b", desc: "Campari ve Vermutun hafif buluşması.", prep: "Buz dolu bardağa dökün, sodayla tamamlayın.", recipe: ["Campari|3cl", "Kırmızı Vermut|3cl", "Soda|Fulleyin"], playlist: ["Mambo Italiano - Dean Martin", "Tu Vuo Fa L'Americano - Renato Carosone", "Via Con Me - Paolo Conte", "Tintarella di Luna - Mina", "Parole Parole - Mina"], query: "campari vermut" },

            // EĞLENCELİ
            "PINA COLADA": { type: "highball", color: "#f1c40f", desc: "Tropikal bir tatil kaçamağı.", prep: "Tüm malzemeleri buzla blenderdan geçirin veya çok iyi çalkalayın.", recipe: ["Beyaz Rom|5cl", "Hindistan Cevizi Kreması|3cl", "Ananas Suyu|10cl"], playlist: ["Escape (Piña Colada Song) - Rupert Holmes", "Copacabana - Barry Manilow", "Club Tropicana - Wham!", "Kokomo - Beach Boys", "Is This Love - Bob Marley"], query: "rom malibu" },
            "MOJITO": { type: "highball", color: "#2ecc71", desc: "Küba'nın ferahlatıcı nane rüzgarı.", prep: "Nane, şeker ve limonu ezin. Rom ve kırık buz ekleyip sodayla tamamlayın.", recipe: ["Beyaz Rom|5cl", "Taze Nane|10 Yaprak", "Limon|Yarım", "Şeker|2 Kaşık", "Soda|Fulleyin"], playlist: ["Havana - Camila Cabello", "Despacito - Luis Fonsi", "Bailando - Enrique Iglesias", "Suavemente - Elvis Crespo", "Danza Kuduro - Don Omar"], query: "rom fiyat" },
            "DAIQUIRI": { type: "martini", color: "#ecf0f1", desc: "Rom, limon ve şekerin mükemmel dengesi.", prep: "Tüm malzemeleri buzla çalkalayıp soğutulmuş bardağa süzün.", recipe: ["Beyaz Rom|6cl", "Limon Suyu|3cl", "Şeker Şurubu|2cl"], playlist: ["Smooth Operator - Sade", "Mas Que Nada - Sergio Mendes", "The Girl from Ipanema - Stan Getz", "Sway - Michael Buble", "Save the Last Dance - Drifters"], query: "beyaz rom" },

            // SEXY
            "NEGRONI": { type: "rocks", color: "#e74c3c", desc: "Kırmızı, acı ve kışkırtıcı.", prep: "Buzlu bardağa dökün ve karıştırın. Portakal dilimi şart.", recipe: ["Cin|3cl", "Campari|3cl", "Kırmızı Vermut|3cl"], playlist: ["Wicked Game - Chris Isaak", "Glory Box - Portishead", "Do I Wanna Know? - Arctic Monkeys", "Back to Black - Amy Winehouse", "Red Right Hand - Nick Cave"], query: "cin campari" },
            "ESPRESSO MARTINI": { type: "martini", color: "#3e2723", desc: "Geceyi uzatmak isteyenlere.", prep: "Sıcak espresso ve alkolleri buzla çok sert çalkalayın.", recipe: ["Votka|5cl", "Kahve Likörü|3cl", "Espresso|1 Shot"], playlist: ["Midnight City - M83", "Starboy - The Weeknd", "Get Lucky - Daft Punk", "Goosebumps - Travis Scott", "Latch - Disclosure"], query: "votka kahlua" },
            "BOULEVARDIER": { type: "rocks", color: "#d35400", desc: "Negroni'nin viskili, karanlık kuzeni.", prep: "Tüm malzemeleri buzla karıştırıp süzün.", recipe: ["Burbon|4.5cl", "Campari|3cl", "Kırmızı Vermut|3cl"], playlist: ["Personal Jesus - Depeche Mode", "Seven Nation Army - The White Stripes", "No Diggity - Blackstreet", "Human - Rag'n'Bone Man", "Way Down We Go - Kaleo"], query: "viski campari" },

            // YORGUN
            "WHITE RUSSIAN": { type: "rocks", color: "#ecf0f1", desc: "Tatlı, kremsi ve rahatlatıcı.", prep: "Votka ve kahve likörünü buzla karıştırın, üzerine kremayı yüzdürün.", recipe: ["Votka|5cl", "Kahve Likörü|2cl", "Krema|3cl"], playlist: ["The Man in Me - Bob Dylan", "Hotel California - Eagles", "Just Dropped In - Kenny Rogers", "Dreams - Fleetwood Mac", "Rocket Man - Elton John"], query: "votka kahlua" },
            "PALOMA": { type: "highball", color: "#ecf0f1", desc: "Meksika'nın ferahlatıcı favorisi.", prep: "Tekila ve limonu buzlu bardağa dökün, greyfurt gazozu ekleyin.", recipe: ["Tekila|5cl", "Limon Suyu|1cl", "Greyfurt Gazozu|Fulleyin"], playlist: ["Californication - RHCP", "Island in the Sun - Weezer", "Santeria - Sublime", "Scar Tissue - RHCP", "Amber - 311"], query: "tekila fiyat" },
            "AMARETTO SOUR": { type: "rocks", color: "#f39c12", desc: "Badem ezmesi tadında yumuşak içim.", prep: "Malzemeleri buzla çalkalayıp süzün.", recipe: ["Amaretto|5cl", "Limon Suyu|3cl", "Şeker Şurubu|1cl"], playlist: ["Easy - Commodores", "Lovely Day - Bill Withers", "Just the Two of Us - Grover Washington Jr.", "Let's Stay Together - Al Green", "Sitting on the Dock of the Bay - Otis Redding"], query: "amaretto fiyat" },

            // MACERACI
            "BLOODY MARY": { type: "highball", color: "#c0392b", desc: "Tuzlu, acı ve besleyici.", prep: "Tüm malzemeleri buzla " + "roll" + " yapın (bir bardaktan diğerine dökün).", recipe: ["Votka|5cl", "Domates Suyu|10cl", "Limon Suyu|1cl", "Baharatlar|Tuz, Biber, Tabasco"], playlist: ["Psycho Killer - Talking Heads", "Sympathy for the Devil - Rolling Stones", "Born to be Wild - Steppenwolf", "Paint It Black - Rolling Stones", "Fortunate Son - CCR"], query: "votka domates suyu" },
            "JUNGLE BIRD": { type: "highball", color: "#e74c3c", desc: "Campari'nin tropikal yorumu.", prep: "Tüm malzemeleri buzla çalkalayıp buzlu bardağa süzün.", recipe: ["Koyu Rom|4.5cl", "Campari|2cl", "Ananas Suyu|4.5cl", "Limon & Şeker|1.5cl"], playlist: ["Welcome to the Jungle - Guns N' Roses", "Africa - Toto", "Down Under - Men at Work", "Safety Dance - Men Without Hats", "Hungry Like the Wolf - Duran Duran"], query: "rom campari" },
            "LAST WORD": { type: "martini", color: "#2ecc71", desc: "Eşit ölçülerin mükemmel dengesi.", prep: "Tüm malzemeleri buzla çalkalayıp süzün.", recipe: ["Cin|2cl", "Yeşil Chartreuse|2cl", "Maraschino|2cl", "Limon Suyu|2cl"], playlist: ["The Final Countdown - Europe", "Don't Stop Believin' - Journey", "Eye of the Tiger - Survivor", "Livin' on a Prayer - Bon Jovi", "Bohemian Rhapsody - Queen"], query: "chartreuse maraschino" },

            // MELANKOLİK
            "NEGRONI SBAGLIATO": { type: "rocks", color: "#e74c3c", desc: "Yanlışlıkla yapılan efsane (Cin yerine Prosecco).", prep: "Buzlu bardağa malzemeleri ekleyip karıştırın.", recipe: ["Prosecco|3cl", "Campari|3cl", "Kırmızı Vermut|3cl"], playlist: ["Someone Like You - Adele", "Fix You - Coldplay", "Yesterday - Beatles", "Tears in Heaven - Eric Clapton", "Hallelujah - Jeff Buckley"], query: "campari prosecco" },
            "PORTO FLIP": { type: "martini", color: "#8e44ad", desc: "Zengin, yoğun ve tatlı.", prep: "Tüm malzemeleri (yumurta sarısı dahil) buzla iyice çalkalayın.", recipe: ["Porto Şarabı|4.5cl", "Konyak|1.5cl", "Yumurta Sarısı|1 Adet"], playlist: ["My Way - Frank Sinatra", "Sound of Silence - Simon & Garfunkel", "Yesterday - Beatles", "Unchained Melody - Righteous Brothers", "Bridge Over Troubled Water - Simon & Garfunkel"], query: "porto şarabı konyak" },
            "MANHATTAN": { type: "martini", color: "#c0392b", desc: "New York'un melankolik yüzü.", prep: "Viski ve vermutu buzla karıştırın (çalkalamayın), süzün.", recipe: ["Çavdar Viski|5cl", "Kırmızı Vermut|2cl", "Angostura|2 Damla"], playlist: ["New York, New York - Frank Sinatra", "Empire State of Mind - Jay-Z", "Piano Man - Billy Joel", "Englishman in New York - Sting", "Streets of Philadelphia - Bruce Springsteen"], query: "viski vermut" },

            // SOSYAL
            "HUGO SPRITZ": { type: "wine", color: "#2ecc71", desc: "Mürver çiçeği ferahlığı.", prep: "Buzlu kadehe likör ve sodayı ekleyin, Prosecco ile tamamlayın.", recipe: ["Prosecco|6cl", "Mürver Çiçeği Likörü|3cl", "Soda|3cl", "Nane|Taze"], playlist: ["Happy - Pharrell Williams", "Can't Stop the Feeling - Justin Timberlake", "Uptown Funk - Bruno Mars", "I Gotta Feeling - Black Eyed Peas", "Dynamite - BTS"], query: "mürver çiçeği likörü" },
            "TOM COLLINS": { type: "highball", color: "#ecf0f1", desc: "Yetişkin limonatası.", prep: "Cin, limon ve şekeri bardağa dökün, buz ve soda ekleyin.", recipe: ["Cin|5cl", "Limon Suyu|3cl", "Şeker Şurubu|2cl", "Soda|Fulleyin"], playlist: ["Mr. Brightside - The Killers", "Chelsea Dagger - The Fratellis", "Last Nite - The Strokes", "Sex on Fire - Kings of Leon", "Pumped Up Kicks - Foster the People"], query: "cin fiyat" },
            "FRENCH 75": { type: "wine", color: "#f1c40f", desc: "Kutlama modu.", prep: "Cin, limon ve şekeri çalkalayın, kadehe döküp şampanya ekleyin.", recipe: ["Cin|3cl", "Limon Suyu|1.5cl", "Şeker|1cl", "Şampanya|Fulleyin"], playlist: ["Raise Your Glass - P!nk", "Firework - Katy Perry", "Roar - Katy Perry", "Shake It Off - Taylor Swift", "Single Ladies - Beyonce"], query: "cin şampanya" },

            // ODAKLI
            "CAMPARI & SODA": { type: "highball", color: "#e74c3c", desc: "Basit, net, şekersiz.", prep: "Campari'yi buzlu bardağa dökün, soda ile tamamlayın.", recipe: ["Campari|6cl", "Soda|Fulleyin"], playlist: ["Take Five - Dave Brubeck", "So What - Miles Davis", "Blue in Green - Miles Davis", "My Favorite Things - John Coltrane", "Autumn Leaves - Cannonball Adderley"], query: "campari fiyat" },
            "DRY MARTINI": { type: "martini", color: "#bdc3c7", desc: "Saf konsantrasyon.", prep: "Cin ve vermutu buzla karıştırıp süzün. Zeytin ekleyin.", recipe: ["Cin|6cl", "Kuru Vermut|1cl", "Zeytin|1 Adet"], playlist: ["007 Theme", "Goldfinger - Shirley Bassey", "Skyfall - Adele", "Live and Let Die - Paul McCartney", "Nobody Does It Better - Carly Simon"], query: "cin vermut" },
            "GIBSON": { type: "martini", color: "#bdc3c7", desc: "Martini'nin soğanlı kuzeni.", prep: "Dry Martini gibi yapın, zeytin yerine arpacık soğanı turşusu koyun.", recipe: ["Cin|6cl", "Kuru Vermut|1cl", "Arpacık Soğanı|1 Adet"], playlist: ["The Mentalist Theme", "Sherlock Theme", "X-Files Theme", "Twin Peaks Theme", "Stranger Things Theme"], query: "cin vermut" },

            // ASİ
            "FERNET & COLA": { type: "highball", color: "#2c3e50", desc: "Arjantin usulü sert karışım.", prep: "Bol buzlu bardağa Fernet dökün, yavaşça kola ekleyin.", recipe: ["Fernet Branca|5cl", "Kola|Fulleyin"], playlist: ["Smells Like Teen Spirit - Nirvana", "Killing in the Name - RATM", "Chop Suey! - SOAD", "Du Hast - Rammstein", "Enter Sandman - Metallica"], query: "fernet branca" },
            "PENICILLIN": { type: "rocks", color: "#f1c40f", desc: "İsli viski ve zencefilin şifası.", prep: "Malzemeleri çalkalayın, buzlu bardağa süzün. Üste isli viski gezdirin.", recipe: ["Harman Viski|6cl", "Limon|2cl", "Bal-Zencefil Şurubu|2cl", "İsli Viski|Üste dök"], playlist: ["Paint It Black - Rolling Stones", "Sympathy for the Devil - Rolling Stones", "Gimme Shelter - Rolling Stones", "Start Me Up - Rolling Stones", "(I Can't Get No) Satisfaction - Rolling Stones"], query: "viski zencefil" },
            "DARK 'N STORMY": { type: "highball", color: "#d35400", desc: "Koyu rom ve zencefil gazozu.", prep: "Bardağı buzla doldurun, zencefil gazozu ekleyin, üste koyu romu yüzdürün.", recipe: ["Koyu Rom|6cl", "Zencefil Gazozu|Fulleyin", "Limon|1 Dilim"], playlist: ["Back in Black - AC/DC", "Thunderstruck - AC/DC", "Highway to Hell - AC/DC", "T.N.T. - AC/DC", "You Shook Me All Night Long - AC/DC"], query: "koyu rom ginger beer" },

            // ROMANTİK
            "BELLINI": { type: "wine", color: "#ffcccc", desc: "Venedik şeftali rüyası.", prep: "Şeftali püresini kadehe koyun, üzerine Prosecco ekleyip karıştırın.", recipe: ["Şeftali Püresi|5cl", "Prosecco|10cl"], playlist: ["That's Amore - Dean Martin", "Volare - Dean Martin", "Sway - Dean Martin", "Mambo Italiano - Dean Martin", "On An Evening In Roma - Dean Martin"], query: "prosecco şeftali" },
            "KIR ROYALE": { type: "wine", color: "#8e44ad", desc: "Zarif frenk üzümü dokunuşu.", prep: "Likörü kadehe dökün, üzerine şampanya ekleyin.", recipe: ["Creme de Cassis|1.5cl", "Şampanya|Fulleyin"], playlist: ["La Vie En Rose - Edith Piaf", "Non, Je Ne Regrette Rien - Edith Piaf", "Milord - Edith Piaf", "Padam Padam - Edith Piaf", "Hymne A L'Amour - Edith Piaf"], query: "creme de cassis" },
            "ROSE SPRITZ": { type: "wine", color: "#ff9ff3", desc: "Pembe ve çiçeksi.", prep: "Buzlu kadehe roze şarap ve soda ekleyin.", recipe: ["Roze Şarap|9cl", "Soda|3cl", "Gül Şurubu|1cl"], playlist: ["La Vie En Rose - Grace Jones", "I Feel Love - Donna Summer", "Love to Love You Baby - Donna Summer", "Hot Stuff - Donna Summer", "Bad Girls - Donna Summer"], query: "roze şarap" }
        };

        // --- MATRİS MANTIĞI (PDF'e GÖRE KARAR AĞACI) ---
        const matrix = {
            "Sakin": {
                "Ferah": { "Yumuşak": "APEROL SPRITZ" },
                "Ekşi": { "Orta": "WHISKEY SOUR" },
                "Mayhoş": { "Orta": "AMERICANO" }
            },
            "Eğlenceli": {
                "Tatlı": { "Orta": "PINA COLADA" },
                "Ferah": { "Orta": "MOJITO" },
                "Ekşi": { "Orta": "DAIQUIRI" }
            },
            "Sexy": {
                "Acı": { "Sert": "NEGRONI" },
                "Tatlı": { "Sert": "ESPRESSO MARTINI" },
                "Mayhoş": { "Çok Sert": "BOULEVARDIER" }
            },
            "Yorgun": {
                "Tatlı": { "Orta": "WHITE RUSSIAN" },
                "Ferah": { "Yumuşak": "PALOMA" },
                "Ekşi": { "Orta": "AMARETTO SOUR" }
            },
            "Maceracı": {
                "Baharatlı": { "Sert": "BLOODY MARY" },
                "Acı": { "Sert": "JUNGLE BIRD" },
                "Ekşi": { "Çok Sert": "LAST WORD" }
            },
            "Melankolik": {
                "Acı": { "Sert": "NEGRONI SBAGLIATO" },
                "Tatlı": { "Orta": "PORTO FLIP" },
                "Mayhoş": { "Sert": "MANHATTAN" }
            },
            "Sosyal": {
                "Ferah": { "Yumuşak": "HUGO SPRITZ" },
                "Ekşi": { "Orta": "TOM COLLINS" },
                "Tatlı": { "Orta": "FRENCH 75" }
            },
            "Odaklı": {
                "Acı": { "Orta": "CAMPARI & SODA" },
                "Ekşi": { "Sert": "DRY MARTINI" },
                "Mayhoş": { "Sert": "GIBSON" }
            },
            "Asi": {
                "Acı": { "Çok Sert": "FERNET & COLA" },
                "Ekşi": { "Sert": "PENICILLIN" },
                "Baharatlı": { "Sert": "DARK 'N STORMY" }
            },
            "Romantik": {
                "Tatlı": { "Orta": "BELLINI" },
                "Mayhoş": { "Orta": "KIR ROYALE" },
                "Ferah": { "Yumuşak": "ROSE SPRITZ" }
            }
        };

        // --- İŞLEYİŞ ---
        let currentStep = 0;
        let userChoices = { mood: null, taste: null, intensity: null };
        
        const dialogue = document.getElementById('dialogue-text');
        const optArea = document.getElementById('options-area');
        const bartenderLayer = document.getElementById('bartender-layer');
        const shakerLayer = document.getElementById('shaker-layer');
        const presentationLayer = document.getElementById('presentation-layer');
        const shaker = document.getElementById('shaker');
        const stream = document.getElementById('stream');
        const glassPath = document.getElementById('glass-path');
        const liquidPath = document.getElementById('liquid-path');
        const resultCard = document.getElementById('result-card');
        const root = document.documentElement;

        function type(txt, cb) {
            dialogue.textContent = "";
            let i = 0; let currentText = "";
            let timer = setInterval(() => {
                currentText += txt.charAt(i); dialogue.textContent = currentText; i++;
                if(i >= txt.length) { clearInterval(timer); if(cb) cb(); }
            }, 30);
        }

        function setScene(scene) {
            bartenderLayer.style.opacity = 0; shakerLayer.style.opacity = 0; shakerLayer.style.transform = "translate(-50%, 20px)"; presentationLayer.style.opacity = 0; shaker.classList.remove('is-shaking');
            if(scene === 'bartender') { bartenderLayer.style.opacity = 1; }
            else if(scene === 'shaker') { shakerLayer.style.opacity = 1; shakerLayer.style.transform = "translate(-50%, 0)"; setTimeout(() => shaker.classList.add('is-shaking'), 300); }
            else if(scene === 'presentation') { presentationLayer.style.opacity = 1; }
        }

        function renderStep() {
            optArea.innerHTML = ""; optArea.style.opacity = 0; setScene('bartender');
            
            // ADIM 0: MOOD SEÇİMİ
            if (currentStep === 0) {
                type("Hoş geldin. Bugün ruh halin nasıl?", () => {
                    const moods = Object.keys(matrix);
                    moods.forEach(m => createBtn(m, () => { userChoices.mood = m; currentStep++; renderStep(); }));
                    optArea.style.animation = "fadeIn 0.5s forwards";
                });
            }
            // ADIM 1: TAT SEÇİMİ (Mood'a göre filtrelenmiş)
            else if (currentStep === 1) {
                const tastes = Object.keys(matrix[userChoices.mood]);
                type(`${userChoices.mood} hissediyorsun... Peki damağında ne arıyorsun?`, () => {
                    tastes.forEach(t => createBtn(t, () => { userChoices.taste = t; currentStep++; renderStep(); }));
                    optArea.style.animation = "fadeIn 0.5s forwards";
                });
            }
            // ADIM 2: SERTLİK SEÇİMİ (Mood ve Tat'a göre filtrelenmiş)
            else if (currentStep === 2) {
                const intensities = Object.keys(matrix[userChoices.mood][userChoices.taste]);
                type("Son olarak, sertlik derecesi?", () => {
                    intensities.forEach(i => createBtn(i, () => { userChoices.intensity = i; calculate(); }));
                    optArea.style.animation = "fadeIn 0.5s forwards";
                });
            }
        }

        function createBtn(text, onClick) {
            let btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = "> " + text;
            btn.onclick = onClick;
            optArea.appendChild(btn);
        }

        function calculate() {
            type("Seçimler analiz ediliyor... Karışım hazırlanıyor...", () => {
                optArea.style.display = "none"; setScene('shaker');
                
                // Matristen sonucu bul
                const resultName = matrix[userChoices.mood][userChoices.taste][userChoices.intensity];
                const bestDrink = drinksDB[resultName];

                setTimeout(() => {
                    showResult(bestDrink);
                }, 2000);
            });
        }

        function showResult(drink) {
            setScene('presentation');
            let paths = glassPaths[drink.type] || glassPaths.rocks;
            glassPath.setAttribute('d', paths.path); liquidPath.setAttribute('d', paths.fill);
            root.style.setProperty('--primary', drink.color); stream.style.background = drink.color; stream.style.boxShadow = `0 0 10px ${drink.color}`; liquidPath.style.fill = drink.color;
            setTimeout(() => {
                stream.style.height = "100px";
                setTimeout(() => {
                    liquidPath.style.opacity = 0.8;
                    setTimeout(() => { stream.style.height = "0"; stream.style.top = "120px"; finish(drink); }, 800);
                }, 400);
            }, 300);
        }

        function finish(drink) {
            resultCard.style.display = "block";
            // Matristen gelen key'i başlık yap (düzeltme: resultName kullanabilirdik ama drink objesinde name yoksa key kullanılır, burada manual DB olduğu için keyleri eşledik)
            // drinksDB'de keyleri büyük harfle yazdık, o yüzden drink.name yerine anahtarı bulmamız lazım ya da DB'ye name eklemeliyiz.
            // *Düzeltme:* DB yapısında name zaten var.
            
            // İsmi bulmak için ters arama ya da DB'ye name ekleme. DB'de name yok, key var.
            // Hızlı çözüm: DB anahtarlarını name olarak kabul et.
            // Fakat yukarıda DB'yi güncelledik ve name ekledik mi? Evet önceki kodda vardı, bunda silmişim.
            // HATA DÜZELTME: drinksDB key-value yapısına döndü. Name'i keyden alalım.
            // Yukarıdaki calculate fonksiyonunda `const bestDrink = drinksDB[resultName]` dedik.
            // resultName string'i ("APEROL SPRITZ") elimizde.
            
            // drink objesinin içine name eklemedim, key'i title yapalım.
            // Ancak önceki kodda 'name' prop'u vardı.
            // Manuel düzeltme: resultName değişkenini finish'e taşımamız lazım.
            // Ya da drink objesine name ekleyelim. (Ekliyorum şimdi DB'ye sanal olarak)
            
            // DB yapısında `name` alanı YOK. Matrisin value'su direkt isim.
            // O yüzden başlığı resultName'den alacağız. 
            // Ancak finish fonksiyonuna sadece `drink` objesi gidiyor.
            // Calculate içinde resultName'i drink objesine ekleyelim geçici olarak.
            
            document.getElementById('drink-title').innerText = drink._name; // _name'i calculate'de ekleyeceğiz
            document.getElementById('drink-desc').innerText = drink.desc;
            document.getElementById('drink-prep').innerText = drink.prep;
            
            const recipeList = document.getElementById('drink-recipe');
            recipeList.innerHTML = "";
            drink.recipe.forEach(item => {
                const parts = item.split('|');
                const li = document.createElement('li');
                if(parts.length > 1) { li.innerHTML = `<span>${parts[0]}</span> <span>${parts[1]}</span>`; } 
                else { li.innerText = parts[0]; }
                recipeList.appendChild(li);
            });

            const playlistBox = document.getElementById('playlist-container');
            playlistBox.innerHTML = "";
            if(drink.playlist) {
                drink.playlist.forEach(song => {
                    const div = document.createElement('div');
                    div.className = 'playlist-item';
                    div.innerHTML = `<span class="icon-music">♬</span> ${song}`;
                    playlistBox.appendChild(div);
                });
            }

            document.getElementById('price-btn').href = `https://www.google.com/search?q=${encodeURIComponent(drink.query + " 2026")}`;
            dialogue.textContent = "Servis edildi. Afiyet olsun.";
        }

        // Calculate fonksiyonunu revize edelim (Name eklemek için)
        // Yukarıdaki calculate fonksiyonunu eziyorum:
        const originalCalculate = calculate;
        calculate = function() {
             type("Veriler işleniyor... Karışım hazırlanıyor...", () => {
                optArea.style.display = "none"; setScene('shaker');
                
                const resultName = matrix[userChoices.mood][userChoices.taste][userChoices.intensity];
                const bestDrink = drinksDB[resultName];
                bestDrink._name = resultName; // İsmi objeye ekle

                setTimeout(() => {
                    showResult(bestDrink);
                }, 2000);
            });
        }

        window.onload = () => { renderStep(); }
    </script>
</body>
</html>
