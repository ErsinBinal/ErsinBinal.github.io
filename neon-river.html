<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon River - Chapter I | Convivium</title>
    <meta name="description" content="Bir zamanlar basit bir oyundu... 5. boyutun duvarlarını yıkan bir yolculuğun başlangıcı.">
    <meta name="author" content="Ersin Binal">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #000;
            overflow: hidden;
            font-family: 'Courier New', monospace;
            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }

        /* CGA Renk Paleti */
        :root {
            --cga-black: #000000;
            --cga-cyan: #00AAAA;
            --cga-magenta: #AA00AA;
            --cga-white: #AAAAAA;
            --cga-bright-cyan: #55FFFF;
            --cga-bright-magenta: #FF55FF;
            --cga-yellow: #FFFF55;
        }

        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: #000;
            border: 4px solid var(--cga-cyan);
            box-shadow: 0 0 30px rgba(0, 170, 170, 0.5);
        }

        /* Scanline Effect */
        #gameCanvas::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0,0,0,0.15) 0px,
                transparent 1px,
                transparent 2px,
                rgba(0,0,0,0.15) 3px
            );
            pointer-events: none;
            z-index: 10;
        }

        /* Portal Overlay */
        #portalOverlay {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background: radial-gradient(circle, transparent 0%, #000 100%);
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.5s;
            z-index: 1000;
        }

        #portalOverlay.active {
            opacity: 1;
        }

        /* Loading Message */
        #loadingMsg {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: var(--cga-bright-cyan);
            font-size: 24px;
            text-align: center;
            opacity: 0;
            z-index: 2000;
            text-shadow: 0 0 10px var(--cga-cyan);
        }

        #loadingMsg.show {
            opacity: 1;
            animation: blink 0.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="portalOverlay"></div>
    <div id="loadingMsg">DIMENSIONAL BREACH DETECTED<br>PREPARING JUMP...</div>

    <script>
        // ============================================
        // NEON RIVER - CHAPTER I: THE BEGINNING
        // Oyun tarihinin evrimini anlatan bir yolculuk
        // ============================================

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const portalOverlay = document.getElementById('portalOverlay');
        const loadingMsg = document.getElementById('loadingMsg');

        // Canvas boyutu - DOS çağına uygun 320x200 upscaled
        const GAME_WIDTH = 320;
        const GAME_HEIGHT = 200;
        const SCALE = Math.min(
            Math.floor(window.innerWidth / GAME_WIDTH),
            Math.floor(window.innerHeight / GAME_HEIGHT)
        );

        canvas.width = GAME_WIDTH;
        canvas.height = GAME_HEIGHT;
        canvas.style.width = (GAME_WIDTH * SCALE) + 'px';
        canvas.style.height = (GAME_HEIGHT * SCALE) + 'px';

        // CGA Renk Paleti
        const COLORS = {
            BLACK: '#000000',
            CYAN: '#00AAAA',
            MAGENTA: '#AA00AA',
            WHITE: '#AAAAAA',
            BRIGHT_CYAN: '#55FFFF',
            BRIGHT_MAGENTA: '#FF55FF',
            YELLOW: '#FFFF55'
        };

        // Oyun Durumu
        let gameState = 'PLAYING'; // PLAYING, PORTAL_OPENING, TRANSITIONING
        let score = 0;
        let lives = 3;
        let gameSpeed = 2;

        // Portal
        let portalActive = false;
        let portalRadius = 0;
        let portalRotation = 0;
        let portalPulse = 0;
        let playerInPortal = false;
        let transitionProgress = 0;

        // Oyuncu
        const player = {
            x: GAME_WIDTH / 2,
            y: GAME_HEIGHT - 30,
            width: 8,
            height: 12,
            speed: 3,
            color: COLORS.BRIGHT_CYAN
        };

        // Portal konumu (ekranın ortasında)
        const portal = {
            x: GAME_WIDTH / 2,
            y: GAME_HEIGHT / 3,
            targetRadius: 30
        };

        // Düşmanlar
        const enemies = [];
        const bullets = [];
        const particles = [];

        // Kontroller
        const keys = {};

        window.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            if (e.code === 'Space') {
                shootBullet();
                e.preventDefault();
            }
        });

        window.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });

        // Basit ses sistemi
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(freq, duration, type = 'square') {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.value = freq;
            gain.gain.value = 0.1;
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function shootBullet() {
            bullets.push({
                x: player.x,
                y: player.y - 5,
                width: 2,
                height: 6,
                speed: 4,
                color: COLORS.YELLOW
            });
            playSound(800, 0.1);
        }

        function spawnEnemy() {
            enemies.push({
                x: Math.random() * (GAME_WIDTH - 20) + 10,
                y: -10,
                width: 8,
                height: 8,
                speed: 1 + Math.random(),
                color: Math.random() > 0.5 ? COLORS.MAGENTA : COLORS.BRIGHT_MAGENTA
            });
        }

        function createExplosion(x, y, color) {
            for (let i = 0; i < 8; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 3,
                    vy: (Math.random() - 0.5) * 3,
                    life: 20,
                    color: color
                });
            }
            playSound(150, 0.2, 'sawtooth');
        }

        function updateGame() {
            // Oyuncu hareketi
            if (keys['ArrowLeft'] && player.x > player.width / 2) {
                player.x -= player.speed;
            }
            if (keys['ArrowRight'] && player.x < GAME_WIDTH - player.width / 2) {
                player.x += player.speed;
            }
            if (keys['ArrowUp'] && player.y > player.height / 2) {
                player.y -= player.speed;
            }
            if (keys['ArrowDown'] && player.y < GAME_HEIGHT - player.height / 2) {
                player.y += player.speed;
            }

            // Mermiler
            bullets.forEach((bullet, i) => {
                bullet.y -= bullet.speed;
                if (bullet.y < 0) {
                    bullets.splice(i, 1);
                }
            });

            // Düşmanlar
            enemies.forEach((enemy, i) => {
                enemy.y += enemy.speed * gameSpeed;

                if (enemy.y > GAME_HEIGHT) {
                    enemies.splice(i, 1);
                }

                // Çarpışma kontrolü (mermi - düşman)
                bullets.forEach((bullet, bi) => {
                    if (Math.abs(bullet.x - enemy.x) < 6 &&
                        Math.abs(bullet.y - enemy.y) < 6) {
                        createExplosion(enemy.x, enemy.y, enemy.color);
                        enemies.splice(i, 1);
                        bullets.splice(bi, 1);
                        score += 100;

                        // 3000 puana ulaşınca portal aç!
                        if (score >= 3000 && !portalActive && gameState === 'PLAYING') {
                            activatePortal();
                        }
                    }
                });

                // Oyuncu çarpışması
                if (Math.abs(player.x - enemy.x) < 8 &&
                    Math.abs(player.y - enemy.y) < 8) {
                    createExplosion(player.x, player.y, COLORS.BRIGHT_CYAN);
                    lives--;
                    player.x = GAME_WIDTH / 2;
                    player.y = GAME_HEIGHT - 30;

                    if (lives <= 0) {
                        gameState = 'GAME_OVER';
                    }
                }
            });

            // Partiküller
            particles.forEach((p, i) => {
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                if (p.life <= 0) {
                    particles.splice(i, 1);
                }
            });

            // Portal animasyonu
            if (portalActive && gameState === 'PORTAL_OPENING') {
                portalRadius += 1;
                portalRotation += 0.05;
                portalPulse = Math.sin(Date.now() / 100) * 5;

                // Portal tamamen açıldı
                if (portalRadius >= portal.targetRadius) {
                    gameState = 'PLAYING'; // Portal açık, oyun devam
                }
            }

            // Oyuncu portala girdi mi?
            if (portalActive && gameState === 'PLAYING') {
                const dist = Math.sqrt(
                    Math.pow(player.x - portal.x, 2) +
                    Math.pow(player.y - portal.y, 2)
                );

                if (dist < portalRadius) {
                    startDimensionalJump();
                }
            }

            // Boyut atlama animasyonu
            if (gameState === 'TRANSITIONING') {
                transitionProgress += 0.02;
                portalRadius += 2;
                portalRotation += 0.1;

                if (transitionProgress >= 1) {
                    // Universe-2'ye geçiş yap!
                    window.location.href = 'universe-2.html';
                }
            }
        }

        function activatePortal() {
            portalActive = true;
            gameState = 'PORTAL_OPENING';
            playSound(400, 0.3, 'sine');
            setTimeout(() => playSound(600, 0.3, 'sine'), 100);
            setTimeout(() => playSound(800, 0.5, 'sine'), 200);
        }

        function startDimensionalJump() {
            gameState = 'TRANSITIONING';
            portalOverlay.classList.add('active');
            loadingMsg.classList.add('show');
            playSound(200, 2, 'sine');
        }

        function drawGame() {
            // Temizle
            ctx.fillStyle = COLORS.BLACK;
            ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);

            // Basit yıldız arka planı
            ctx.fillStyle = COLORS.WHITE;
            for (let i = 0; i < 30; i++) {
                const x = (i * 37 + Date.now() / 50) % GAME_WIDTH;
                const y = (i * 17) % GAME_HEIGHT;
                ctx.fillRect(x, y, 1, 1);
            }

            // Portal çiz (eğer aktifse)
            if (portalActive) {
                const px = portal.x;
                const py = portal.y;

                // Portal halkaları
                for (let i = 0; i < 5; i++) {
                    const r = portalRadius - i * 5 + portalPulse;
                    if (r > 0) {
                        ctx.strokeStyle = i % 2 === 0 ? COLORS.BRIGHT_CYAN : COLORS.BRIGHT_MAGENTA;
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.arc(px, py, r, 0, Math.PI * 2);
                        ctx.stroke();
                    }
                }

                // Portal merkezi (dönen spiral)
                ctx.save();
                ctx.translate(px, py);
                ctx.rotate(portalRotation);
                for (let i = 0; i < 8; i++) {
                    const angle = (i / 8) * Math.PI * 2;
                    const x1 = Math.cos(angle) * 5;
                    const y1 = Math.sin(angle) * 5;
                    const x2 = Math.cos(angle) * portalRadius;
                    const y2 = Math.sin(angle) * portalRadius;

                    ctx.strokeStyle = COLORS.YELLOW;
                    ctx.lineWidth = 1;
                    ctx.beginPath();
                    ctx.moveTo(x1, y1);
                    ctx.lineTo(x2, y2);
                    ctx.stroke();
                }
                ctx.restore();

                // Portal metni
                if (gameState === 'PORTAL_OPENING') {
                    ctx.fillStyle = COLORS.YELLOW;
                    ctx.font = '8px "Courier New"';
                    ctx.textAlign = 'center';
                    ctx.fillText('DIMENSIONAL BREACH', px, py - 50);
                }
            }

            // Düşmanlar
            enemies.forEach(enemy => {
                ctx.fillStyle = enemy.color;
                ctx.fillRect(
                    enemy.x - enemy.width / 2,
                    enemy.y - enemy.height / 2,
                    enemy.width,
                    enemy.height
                );
            });

            // Mermiler
            bullets.forEach(bullet => {
                ctx.fillStyle = bullet.color;
                ctx.fillRect(
                    bullet.x - bullet.width / 2,
                    bullet.y - bullet.height / 2,
                    bullet.width,
                    bullet.height
                );
            });

            // Partiküller
            particles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 2, 2);
            });

            // Oyuncu (basit üçgen uçak)
            ctx.fillStyle = player.color;
            ctx.beginPath();
            ctx.moveTo(player.x, player.y - player.height / 2);
            ctx.lineTo(player.x - player.width / 2, player.y + player.height / 2);
            ctx.lineTo(player.x + player.width / 2, player.y + player.height / 2);
            ctx.closePath();
            ctx.fill();

            // UI
            ctx.fillStyle = COLORS.WHITE;
            ctx.font = '8px "Courier New"';
            ctx.textAlign = 'left';
            ctx.fillText('SCORE: ' + score, 5, 10);
            ctx.fillText('LIVES: ' + lives, 5, 20);

            if (score >= 2500 && !portalActive) {
                ctx.fillStyle = COLORS.YELLOW;
                ctx.textAlign = 'center';
                ctx.fillText('DIMENSIONAL ENERGY: ' + Math.floor((score / 3000) * 100) + '%', GAME_WIDTH / 2, 10);
            }

            // Geçiş efekti
            if (gameState === 'TRANSITIONING') {
                ctx.fillStyle = `rgba(85, 255, 255, ${transitionProgress * 0.8})`;
                ctx.fillRect(0, 0, GAME_WIDTH, GAME_HEIGHT);
            }
        }

        // Düşman spawn zamanlayıcı
        setInterval(() => {
            if (gameState === 'PLAYING' || gameState === 'PORTAL_OPENING') {
                spawnEnemy();
            }
        }, 1000);

        // Oyun döngüsü
        function gameLoop() {
            updateGame();
            drawGame();
            requestAnimationFrame(gameLoop);
        }

        // Başlat
        gameLoop();

        // Bilgi mesajı
        setTimeout(() => {
            ctx.fillStyle = COLORS.BRIGHT_CYAN;
            ctx.font = '6px "Courier New"';
            ctx.textAlign = 'center';
            ctx.fillText('USE ARROW KEYS TO MOVE, SPACE TO SHOOT', GAME_WIDTH / 2, GAME_HEIGHT - 5);
        }, 100);
    </script>
</body>
</html>
