<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NEON RIVER: REMASTERED</title>
    <style>
        body { margin: 0; padding: 0; background: #050505; overflow: hidden; touch-action: none; }
        #game-container { width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; background: #000; }
        canvas { box-shadow: 0 0 30px rgba(0, 255, 255, 0.1); }
        /* CRT / Scanline Efekti - Retro TV Hissi */
        .scanlines {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
</head>
<body>

<div class="scanlines"></div>
<div id="game-container"></div>

<script>
// --- OYUN YAPILANDIRMASI ---
const CONFIG = {
    type: Phaser.AUTO,
    width: window.innerWidth > 600 ? 600 : window.innerWidth, // Mobil uyumlu dikey format
    height: window.innerHeight,
    parent: 'game-container',
    physics: {
        default: 'arcade',
        arcade: { 
            gravity: { y: 0 }, 
            debug: false 
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
};

// Global Değişkenler
let game = new Phaser.Game(CONFIG);
let player;
let cursors;
let bullets;
let enemies;
let fuels;
let terrainLeft, terrainRight; // Kanyon duvarları
let bgGrid; // Zemin ızgarası
let score = 0;
let scoreText;
let fuel = 100;
let fuelBar;
let fuelBarBg;
let gameSpeed = 2; // Daha yavaş, kontrollü başlangıç hızı
let lastFired = 0;
let isGameOver = false;

// --- PRELOAD: GRAFİKLERİ OLUŞTURMA ---
function preload() {
    // 1. OYUNCU UÇAĞI (F-14 Tarzı Dolu Gövde)
    let g = this.make.graphics({x: 0, y: 0, add: false});
    
    // Gövde (Gri/Mavi)
    g.fillStyle(0x00aaff, 1);
    g.beginPath();
    g.moveTo(0, -25); // Burun
    g.lineTo(10, 5);
    g.lineTo(20, 10); // Kanat ucu
    g.lineTo(10, 25);
    g.lineTo(-10, 25);
    g.lineTo(-20, 10); // Kanat ucu
    g.lineTo(-10, 5);
    g.closePath();
    g.fillPath();
    
    // Kokpit (Siyah/Koyu)
    g.fillStyle(0x000033, 1);
    g.fillEllipse(0, -5, 6, 12);
    
    // Motor Alevi
    g.fillStyle(0xffaa00, 1);
    g.fillTriangle(-5, 25, 5, 25, 0, 40);
    
    g.generateTexture('playerShip', 42, 50);

    // 2. DÜŞMAN: HELİKOPTER (River Raid Klasiği)
    g.clear();
    g.fillStyle(0xff4444, 1); // Kırmızı Gövde
    g.fillEllipse(16, 16, 20, 24);
    g.fillStyle(0xcccccc, 1); // Pervane
    g.fillRect(2, 14, 28, 4); 
    g.fillRect(14, 2, 4, 28);
    g.generateTexture('enemyHeli', 32, 32);

    // 3. DÜŞMAN: JET
    g.clear();
    g.fillStyle(0xaa00aa, 1); // Mor Jet
    g.beginPath();
    g.moveTo(16, 0); g.lineTo(32, 32); g.lineTo(16, 24); g.lineTo(0, 32);
    g.closePath();
    g.fillPath();
    g.generateTexture('enemyJet', 32, 32);

    // 4. DÜŞMAN: GEMİ (Tanker)
    g.clear();
    g.fillStyle(0x44ff44, 1); // Yeşil Gemi
    g.fillRect(0, 0, 40, 15); // Gövde
    g.fillStyle(0x004400, 1);
    g.fillRect(10, -5, 20, 10); // Kule
    g.generateTexture('enemyShip', 40, 20);

    // 5. YAKIT TANKI (FUEL)
    g.clear();
    g.fillStyle(0xff0088, 1); // Pembe/Neon Kutu
    g.lineStyle(2, 0xffffff);
    g.fillRect(0, 0, 30, 40);
    g.strokeRect(0, 0, 30, 40);
    g.generateTexture('fuelTank', 30, 40);

    // 6. MERMİ
    g.clear();
    g.fillStyle(0xffff00, 1);
    g.fillRect(0, 0, 4, 12);
    g.generateTexture('bullet', 4, 12);

    // 7. ZEMİN IZGARASI (Grid)
    g.clear();
    g.lineStyle(1, 0x004400, 0.5); // Koyu yeşil çizgiler
    g.strokeRect(0, 0, 64, 64);
    g.generateTexture('gridTile', 64, 64);

    // 8. KANYON DUVARI (Terrain)
    g.clear();
    g.fillStyle(0x002200, 1); // Koyu Yeşil Zemin
    g.fillRect(0, 0, 32, 32);
    g.lineStyle(2, 0x00ff00, 1); // Parlak Kenar
    g.beginPath(); g.moveTo(32, 0); g.lineTo(32, 32); g.strokePath();
    g.generateTexture('wallLeft', 32, 32);

    g.clear();
    g.fillStyle(0x002200, 1);
    g.fillRect(0, 0, 32, 32);
    g.lineStyle(2, 0x00ff00, 1);
    g.beginPath(); g.moveTo(0, 0); g.lineTo(0, 32); g.strokePath();
    g.generateTexture('wallRight', 32, 32);
}

// --- CREATE: OYUNU KURMA ---
function create() {
    // 1. ZEMİN (Sonsuz Akan Grid)
    bgGrid = this.add.tileSprite(CONFIG.width/2, CONFIG.height/2, CONFIG.width, CONFIG.height, 'gridTile');
    bgGrid.setTint(0x55ff55); // Matris yeşili tonu

    // 2. KANYON DUVARLARI (Nehir kenarları)
    // Sol Duvar
    terrainLeft = this.add.tileSprite(16, CONFIG.height/2, 32, CONFIG.height, 'wallLeft');
    this.physics.add.existing(terrainLeft, true); // Statik fizik objesi
    
    // Sağ Duvar
    terrainRight = this.add.tileSprite(CONFIG.width - 16, CONFIG.height/2, 32, CONFIG.height, 'wallRight');
    this.physics.add.existing(terrainRight, true);

    // 3. OYUNCU
    player = this.physics.add.sprite(CONFIG.width/2, CONFIG.height - 100, 'playerShip');
    player.setCollideWorldBounds(true);
    player.setDrag(500); // Tuşu bırakınca kayarak durur (Akıcılık)
    player.setDepth(10); // En üstte görünsün

    // 4. GRUPLAR
    bullets = this.physics.add.group();
    enemies = this.physics.add.group();
    fuels = this.physics.add.group();

    // 5. ARAYÜZ (UI)
    // Skor
    scoreText = this.add.text(50, 20, 'SKOR: 0', { 
        fontSize: '24px', fill: '#fff', fontFamily: 'Courier', stroke: '#000', strokeThickness: 4 
    }).setDepth(20);
    
    // Yakıt Göstergesi
    this.add.text(50, 50, 'FUEL', { fontSize: '16px', fill: '#fff', fontFamily: 'Courier' }).setDepth(20);
    fuelBarBg = this.add.rectangle(150, 58, 200, 16, 0xffffff).setStrokeStyle(2, 0xffffff).setDepth(20); // Çerçeve
    fuelBar = this.add.rectangle(150, 58, 196, 12, 0x00ff00).setDepth(20); // Doluluk

    // 6. GİRDİLER (Input)
    cursors = this.input.keyboard.createCursorKeys();
    this.input.on('pointermove', (pointer) => {
        if (!isGameOver && pointer.isDown) {
            // Mobilde parmağı takip et, ama duvarların içine girmesine izin verme
            let targetX = Phaser.Math.Clamp(pointer.x, 60, CONFIG.width - 60);
            this.physics.moveTo(player, targetX, pointer.y - 50, 400);
            fireWeapon.call(this); // Mobilde otomatik ateş
        }
    });

    // 7. ÇARPIŞMALAR (Collision)
    // Mermi -> Düşman
    this.physics.add.overlap(bullets, enemies, hitEnemy, null, this);
    // Mermi -> Yakıt (Yakıtı vurursan patlar!)
    this.physics.add.overlap(bullets, fuels, hitFuelTank, null, this);
    // Oyuncu -> Düşman
    this.physics.add.overlap(player, enemies, crashPlayer, null, this);
    // Oyuncu -> Yakıt (Toplama)
    this.physics.add.overlap(player, fuels, collectFuel, null, this);

    // 8. DÖNGÜLER (Spawn Timers)
    this.time.addEvent({ delay: 1500, callback: spawnEnemy, callbackScope: this, loop: true });
    this.time.addEvent({ delay: 500, callback: decreaseFuel, callbackScope: this, loop: true });
}

// --- UPDATE: HER KAREDE ÇALIŞIR ---
function update() {
    if (isGameOver) return;

    // 1. Zemin Kaydırma (Hız hissi)
    bgGrid.tilePositionY -= gameSpeed;
    terrainLeft.tilePositionY -= gameSpeed;
    terrainRight.tilePositionY -= gameSpeed;

    // 2. Oyuncu Kontrolü (PC)
    player.setVelocityX(0);
    player.setVelocityY(0);

    // Hızlandırılmış ama kontrollü hareket
    let moveSpeed = 300;
    if (cursors.left.isDown) player.setVelocityX(-moveSpeed);
    else if (cursors.right.isDown) player.setVelocityX(moveSpeed);

    if (cursors.up.isDown) player.setVelocityY(-moveSpeed); // İleri gitme eklendi
    else if (cursors.down.isDown) player.setVelocityY(moveSpeed); // Geri gitme eklendi

    // Duvarlara çarpma kontrolü (Manuel sınır)
    if (player.x < 50) player.x = 50;
    if (player.x > CONFIG.width - 50) player.x = CONFIG.width - 50;

    // Ateş Etme (Space)
    if (cursors.space.isDown) {
        fireWeapon.call(this);
    }

    // 3. Objelerin Temizlenmesi
    bullets.children.each(b => { if (b.y < -50) b.destroy(); });
    enemies.children.each(e => { if (e.y > CONFIG.height + 50) e.destroy(); });
    fuels.children.each(f => { if (f.y > CONFIG.height + 50) f.destroy(); });

    // 4. Yakıt Barı Güncelleme
    fuelBar.width = Math.max(0, (fuel / 100) * 196);
    // Renk değiştirme (Azalınca Kırmızı)
    if (fuel < 30) fuelBar.fillColor = 0xff0000;
    else fuelBar.fillColor = 0x00ff00;
}

// --- FONKSİYONLAR ---

function spawnEnemy() {
    if (isGameOver) return;

    // Kanyonun içinde (duvarlara değmeyecek şekilde) rastgele X
    let x = Phaser.Math.Between(60, CONFIG.width - 60);
    
    // Rastgele obje seçimi
    let chance = Phaser.Math.Between(0, 100);
    
    if (chance < 20) {
        // %20 şansla YAKIT
        let f = fuels.create(x, -50, 'fuelTank');
        f.setVelocityY(gameSpeed * 60); // Oyun hızıyla orantılı inş
        // "FUEL" yazısı ekle (Basit grafik üzerine)
    } else {
        // %80 şansla DÜŞMAN
        let type = 'enemyHeli';
        let speed = 100;
        
        if (chance > 50 && chance < 80) { type = 'enemyJet'; speed = 200; }
        else if (chance >= 80) { type = 'enemyShip'; speed = 50; } // Gemi yavaş

        let e = enemies.create(x, -50, type);
        e.setVelocityY(speed + (gameSpeed * 20)); // Aşağı inme hızı
        
        // Helikopterler hafif sağa sola sallansın
        if (type === 'enemyHeli') {
            e.setVelocityX(Phaser.Math.Between(-20, 20));
        }
    }
}

function fireWeapon() {
    let now = this.time.now;
    if (now - lastFired < 250) return; // Ateş hızı limiti

    let b = bullets.create(player.x, player.y - 30, 'bullet');
    b.setVelocityY(-600); // Mermi hızı
    lastFired = now;
}

function hitEnemy(bullet, enemy) {
    bullet.destroy();
    createExplosion(this, enemy.x, enemy.y, 0xffaa00); // Turuncu patlama
    enemy.destroy();
    
    score += 100;
    scoreText.setText('SKOR: ' + score);
    
    // Her 1000 puanda oyun biraz hızlansın (Akıcılık ayarı)
    if (score % 1000 === 0) {
        gameSpeed += 0.5;
    }
}

function hitFuelTank(bullet, tank) {
    bullet.destroy();
    tank.destroy();
    createExplosion(this, tank.x, tank.y, 0xff0000); // Kırmızı patlama
    score -= 50; // Ceza! Yakıtı vurmamalısın.
    scoreText.setText('SKOR: ' + score);
}

function collectFuel(player, tank) {
    tank.destroy();
    fuel = Math.min(100, fuel + 30); // Yakıt doldur
    score += 50;
    scoreText.setText('SKOR: ' + score);
    // Yeşil parlama efekti (basit)
    let text = this.add.text(player.x, player.y - 40, '+FUEL', { fontSize:'14px', fill:'#0f0' });
    this.tweens.add({ targets:text, y: player.y-80, alpha:0, duration:1000 });
}

function crashPlayer(player, enemy) {
    createExplosion(this, player.x, player.y, 0x00ffff);
    createExplosion(this, enemy.x, enemy.y, 0xff0000);
    player.setVisible(false);
    gameOver.call(this, "ÇARPIŞMA!");
}

function decreaseFuel() {
    if (isGameOver) return;
    fuel -= 1.5; // Yakıt tüketim hızı
    if (fuel <= 0) {
        gameOver.call(this, "YAKIT BİTTİ!");
    }
}

function createExplosion(scene, x, y, color) {
    // Parçacık efekti
    let particles = scene.add.particles(0, 0, 'bullet', {
        x: x, y: y,
        speed: { min: 50, max: 200 },
        angle: { min: 0, max: 360 },
        scale: { start: 1, end: 0 },
        blendMode: 'ADD',
        tint: color,
        lifespan: 400,
        quantity: 10
    });
    // Kısa süre sonra temizle
    scene.time.delayedCall(400, () => particles.destroy());
}

function gameOver(reason) {
    isGameOver = true;
    this.physics.pause();
    
    let rect = this.add.rectangle(CONFIG.width/2, CONFIG.height/2, 400, 200, 0x000000, 0.8);
    rect.setStrokeStyle(2, 0xff0000);
    
    this.add.text(CONFIG.width/2, CONFIG.height/2 - 40, reason, { fontSize: '32px', fill: '#f00' }).setOrigin(0.5);
    this.add.text(CONFIG.width/2, CONFIG.height/2, 'TOPLAM SKOR: ' + score, { fontSize: '24px', fill: '#fff' }).setOrigin(0.5);
    
    let btn = this.add.text(CONFIG.width/2, CONFIG.height/2 + 50, 'TEKRAR DENE', { 
        fontSize: '28px', fill: '#0f0', backgroundColor: '#111', padding: { x:10, y:5 } 
    }).setOrigin(0.5).setInteractive();
    
    btn.on('pointerdown', () => {
        location.reload();
    });
}
</script>
</body>
</html>
