<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cyberpunk Logic Terminal</title>
    <meta name="description" content="Kısa mantık soruları ve retro terminal estetiğinde interaktif bulmaca deneyimi.">
    <link rel="canonical" href="https://ersinbinal.github.io/cyberpunk-logic-game.html">
    <meta property="og:site_name" content="Convivium - Bulmacalar">
    <meta property="og:title" content="Cyberpunk Logic Terminal">
    <meta property="og:description" content="Kısa mantık soruları ve retro terminal estetiğinde interaktif bulmaca deneyimi.">
    <meta property="og:type" content="game">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <style>
        :root {
            --neon-text-color: #f40;
            --neon-border-color: #08f;
            --background-color: #000;
            --terminal-green: #0f8;
            --terminal-red: #f00;
            --terminal-blue: #08f;
        }
        
        @font-face {
            font-family: 'VT323';
            src: url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/webfonts/fa-brands-400.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Courier New', monospace;
        }
        
        body {
    background-color: #000;
    color: var(--terminal-green);
    height: 100vh;
    overflow: auto; /* Mobilde kaydırmayı etkinleştir */
    padding: 20px;
    display: flex;
    flex-direction: column;
    justify-content: center; /* İçeriği dikeyde ortalar */
    align-items: center;
        }
        
        #terminal {
    border: 2px solid var(--neon-border-color);
    border-radius: 5px;
    padding: 15px; /* Mobilde daha dar padding */
    flex-grow: 1;
    max-width: 800px; /* Büyük ekranlar için maksimum genişlik */
    width: 80%; /* Mobilde daha küçük olması için */
    box-shadow: 0 0 15px var(--neon-border-color);
    text-shadow: 0 0 5px rgba(0, 255, 200, 0.5);
    position: relative;
    overflow: hidden;
}
        
        #intro-animation {
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        #loading-bar-container {
            width: 80%;
            height: 30px;
            border: 1px solid var(--neon-border-color);
            margin-top: 20px;
            position: relative;
            overflow: hidden;
        }
        
        #loading-bar {
            height: 100%;
            width: 0%;
            background-color: var(--terminal-green);
            position: relative;
            transition: width 0.2s ease;
        }
        
        .loading-text {
            font-size: 16px;
            margin: 5px 0;
        }
        
        #question-container {
            display: none;
            height: 100%;
        }
        
        #timer {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            color: var(--neon-text-color);
        }
        
        #score {
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 24px;
        }
        
        #question {
            font-size: 24px;
            margin-bottom: 30px;
            margin-top: 60px;
        }
        
        #options {
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: center;
    width: 100%;
}

.option {
    padding: 12px 20px;
    font-size: 16px;
    width: 90%;
    max-width: 400px; /* Büyük ekranlarda aşırı genişlemeyi önler */
    background-color: rgba(0, 100, 100, 0.3);
    border: 1px solid var(--neon-border-color);
    color: var(--terminal-green);
    cursor: pointer;
    text-align: center;
    transition: all 0.3s ease;
}

@media (min-width: 768px) {
    #options {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
    }

    .option {
        width: 45%;
    }
}
        
        .option:hover {
            background-color: rgba(0, 150, 150, 0.4);
            box-shadow: 0 0 10px var(--neon-border-color);
        }
        
        #results {
            display: none;
            height: 100%;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        #final-score {
            font-size: 72px;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        @media (prefers-reduced-motion: reduce) {
            * { animation-duration: 0.001ms !important; animation-iteration-count: 1 !important; transition-duration: 0.001ms !important; }
        }
        
        @keyframes glitch {
            0% {
                clip-path: inset(40% 0 61% 0);
                transform: translate(-20px, -10px);
            }
            20% {
                clip-path: inset(92% 0 1% 0);
                transform: translate(20px, 10px);
            }
            40% {
                clip-path: inset(43% 0 1% 0);
                transform: translate(-20px, -10px);
            }
            60% {
                clip-path: inset(25% 0 58% 0);
                transform: translate(20px, 10px);
            }
            80% {
                clip-path: inset(54% 0 7% 0);
                transform: translate(-20px, -10px);
            }
            100% {
                clip-path: inset(58% 0 43% 0);
                transform: translate(20px, 10px);
            }
        }
        
        .glitching {
            position: relative;
        }
        
        .glitching::before, .glitching::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--background-color);
        }
        
        .glitching::before {
            color: #f0f;
            animation: glitch 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) both infinite;
        }
        
        .glitching::after {
            color: #0ff;
            animation: glitch 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94) reverse both infinite;
        }
        
        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: rgba(0, 255, 200, 0.3);
            opacity: 0.5;
            animation: scan 5s linear infinite;
            pointer-events: none;
        }
        
        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }
        
        .correct {
            background-color: rgba(0, 255, 0, 0.3) !important;
        }
        
        .incorrect {
            background-color: rgba(255, 0, 0, 0.3) !important;
        }
        
        .skip {
            background-color: rgba(0, 100, 255, 0.3) !important;
        }
        @media (max-width: 768px) {
    body {
        padding: 10px;
        font-size: 14px;
    }

    #terminal {
        width: 95%;
        padding: 10px;
        border-width: 1px;
        box-shadow: 0 0 10px var(--neon-border-color);
    }

    #score, #timer {
        font-size: 18px;
    }

    #question {
        font-size: 18px;
    }

    .option {
        font-size: 16px;
        padding: 12px;
    }
}

@media (max-width: 500px) {
    #terminal {
        padding: 8px;
        font-size: 12px;
    }

    #score, #timer {
        font-size: 14px;
    }

    #question {
        font-size: 16px;
    }

    .option {
        font-size: 14px;
        padding: 10px;
    }
}
@keyframes blinkEffect {
    0% { opacity: 1; }
    50% { opacity: 0.5; } /* Ani kaybolma yerine hafif bir solma */
    100% { opacity: 1; }
}
        /* Magic guard actor styles */
        #magic-guard { display:none; position:absolute; inset:0; background:rgba(0,0,0,0.95); z-index:60; align-items:center; justify-content:center; }
        .magic-inner { text-align:center; color:#fff; display:flex; flex-direction:column; align-items:center; gap:16px; }
        .magic-title { font-size:48px; color:#f0f; }
        .magic-sub { font-size:20px; color:#0ff; }
    .magic-gif { width:260px; height:auto; border:4px solid rgba(8,143,255,0.6); border-radius:8px; box-shadow:0 0 30px rgba(8,143,255,0.15); }
        /* Daha gerçekçi hareket için parça parça animasyonlar */
        .shoulder { transform-origin: 30% 40%; animation: shoulderMove 1.2s ease-in-out infinite; }
        .elbow { transform-origin: 70% 20%; animation: elbowBend 1.2s ease-in-out infinite; }
        .wrist { transform-origin: 90% 10%; animation: wristTwist 1.2s ease-in-out infinite; }
        .finger { transform-origin: 96% 5%; animation: fingerWag 0.9s ease-in-out infinite; }

        @keyframes shoulderMove {
            0% { transform: rotate(0deg); }
            20% { transform: rotate(8deg); }
            40% { transform: rotate(2deg); }
            60% { transform: rotate(-6deg); }
            80% { transform: rotate(-2deg); }
            100% { transform: rotate(0deg); }
        }
        @keyframes elbowBend {
            0% { transform: rotate(0deg); }
            30% { transform: rotate(14deg); }
            50% { transform: rotate(8deg); }
            70% { transform: rotate(-6deg); }
            100% { transform: rotate(0deg); }
        }
        @keyframes wristTwist {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(22deg); }
            50% { transform: rotate(8deg); }
            75% { transform: rotate(-10deg); }
            100% { transform: rotate(0deg); }
        }
        @keyframes fingerWag {
            0% { transform: rotate(0deg); }
            30% { transform: rotate(30deg); }
            55% { transform: rotate(10deg); }
            80% { transform: rotate(-8deg); }
            100% { transform: rotate(0deg); }
        }
        .skip-link:focus { position: static; left: 12px; top: 12px; background: #00ff00; color: #000; padding: 8px 12px; z-index:9999; border-radius:4px; }
    </style>
</head>
<body>
  <script type="application/ld+json">{ "@context":"https://schema.org","@type":"WebSite","name":"Convivium - Ersin Binal","url":"https://ersinbinal.github.io/" }</script>
    <div id="terminal" role="main" aria-label="Cyberpunk Logic Terminal">
        <a class="skip-link" href="#terminal" style="position:absolute;left:-999px;top:auto;overflow:hidden;">İçeriğe atla</a>
        <div class="scan-line"></div>
        
        <div id="score">PUAN: 0</div>
        <div id="timer">SÜRE: 10:00</div>
        
        <div id="intro-animation">
            <h1>SİSTEM BAŞLATILIYOR...</h1>
            <div id="loading-bar-container">
                <div id="loading-bar"></div>
            </div>
            <div id="loading-text-container"></div>
        </div>
        
        <div id="question-container">
            <div id="question"></div>
            <div id="options"></div>
        </div>
        
        <div id="results">
            <h1>TEST TAMAMLANDI</h1>
            <h2>TOPLAM PUANINIZ:</h2>
            <div id="final-score">0</div>
            <div id="scoreboard-entry" style="margin-top:32px; display:none;">
                <label for="player-initials" style="font-size:1.2em;">3 Harfli İsminizi Girin:</label><br>
                <input id="player-initials" maxlength="3" style="text-transform:uppercase; font-size:2em; width:80px; text-align:center; background:#000; color:#0f8; border:2px solid #08f; margin:12px 0;" autofocus>
                <button id="submit-score" style="padding:8px 18px; font-size:1.1em; background:#111; color:#0f8; border:2px solid #08f; border-radius:6px; cursor:pointer;">Kaydet</button>
            </div>
            <!-- Magic word guard (görsel uyarı) -->
            <div id="magic-guard"> 
                <div class="magic-inner">
                    <!-- Kullanıcının istediği Tenor GIF'i -->
                    <img class="magic-gif" src="https://media1.tenor.com/m/j6yQlsga11wAAAAd/dennis-nedry-jurassic-park.gif" alt="Dennis Nedry - You didn't say the magic word" loading="lazy" decoding="async" />
                    <div class="magic-title">Ah ah ah!</div>
                    <div class="magic-sub">You didn't say the magic word!</div>
                </div>
            </div>
            <div id="scoreboard" style="margin-top:40px; display:none;">
                <h2 style="font-family:'Courier New',monospace;color:#08f;">SCOREBOARD</h2>
                <table style="width:100%;border-collapse:collapse;">
                    <thead>
                        <tr style="color:#0f8;font-size:1.1em;border-bottom:2px solid #08f;">
                            <th style="text-align:left;padding:8px 24px 8px 8px;">İsim</th>
                            <th style="text-align:center;padding:8px 24px;">Puan</th>
                            <th style="text-align:right;padding:8px 24px 8px 8px;">Süre</th>
                        </tr>
                    </thead>
                    <tbody id="scoreboard-body"></tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script>
        // Store game state
        const gameState = {
            currentQuestion: 0,
            score: 0,
            timeRemaining: 600, // 10 minutes in seconds
            timer: null,
            answerTime: 0, // When the answer was submitted
            questions: [
                {
                    question: "8 tane bilardo topunuz var; bu toplardan biri diğerlerinden daha ağır. Elinizde sadece bir eşit kollu terazi (ağırlık terazisi) olduğunu düşünün. Ağır olan topu kesin olarak bulmak için en az kaç tartım yapmanız gerekir?",
                    options: [
                        { text: "A) 2 denemede" },
                        { text: "B) 3 denemede" },
                        { text: "C) 4 denemede" },
                        { text: "D) 5 denemede" },
                        { text: "Bu soruyu geç", skip: true }
                    ]
                },
                {
                    question: "Aşağıdaki sayı dizisini devam ettirdiğimizde bir sonraki sayı ne olur? 2, 3, 5, 8, 13, 21, ...",
                    options: [
                        { text: "A) 26" },
                        { text: "B) 29" },
                        { text: "C) 34" },
                        { text: "D) 36" },
                        { text: "Bu soruyu geç", skip: true }
                    ]
                },
                {
                    question: "127 oyuncunun katılacağı bir tenis turnuvasında 63 maçta karşılaşacak olan 126 oyuncu ve maç yapmadan tur atlayacak tek bir oyuncu var. Bir sonraki turda 64 oyuncu 32 tur yapacak şampiyonu belirlemek için toplam kaç tane maç yapılmalı?",
                    options: [
                        { text: "A) 126" },
                        { text: "B) 127" },
                        { text: "C) 63" },
                        { text: "D) 64" },
                        { text: "Bu soruyu geç", skip: true }
                    ]
                },
                {
                    question: "Size dönük bir silah var ve içinde 6 ihtimalde 4 boş 2 dolu mermi var. Birkez tetik çekildi ve silah patlamadı. İkinci kez tetik çekilmeden önce mermilerin yerlerinin değişmesi için çevrilmesinimi seçersini yoksa düzen değişmeden yeniden tetiğe basılmasınımı istersiniz? ",
                    options: [
                        { text: "A) Yeniden Çevir" },
                        { text: "B) Çevirmeden tetiğe bas" },
                        { text: "Bu soruyu geç", skip: true }
                    ]
                },
                {
                    question: "Etkisi en az olacak şıkkı seçin?",
                    options: [
                        { text: "A) 1 Ton" },
                        { text: "B) 3 G-Kuvvet" },
                        { text: "C) 1618" },
                        { text: "D) 0" },
                        { text: "Bu soruyu geç", skip: true }
                    ]
                },
                
            ],
            startTime: null,
            endTime: null
        };
        
        // DOM elements
        const introAnimation = document.getElementById('intro-animation');
        const loadingBar = document.getElementById('loading-bar');
        const questionContainer = document.getElementById('question-container');
        const questionElement = document.getElementById('question');
        const optionsElement = document.getElementById('options');
        const timerElement = document.getElementById('timer');
        const scoreElement = document.getElementById('score');
        const resultsElement = document.getElementById('results');
        const finalScoreElement = document.getElementById('final-score');

        // Obfuscated answers: base64 blob of bytes where each byte = (correctIndex XOR _SALT)
        const _SALT = 0x5a;
        const _OBF_B64 = 'WlhaWqU='; // base64 encoded bytes [0x5A,0x58,0x5A,0x5A,0xA5]
        // decode to array of numbers
        const obfAnswers = (function(b64){
            try {
                const raw = atob(b64);
                const arr = [];
                for(let i=0;i<raw.length;i++) arr.push(raw.charCodeAt(i));
                return arr;
            } catch(e){ return []; }
        })(_OBF_B64);
        // Yükleme sırasında sırayla gösterilecek metinler
        const loadingMessages = [
    "Mantık protokolleri yükleniyor...",
    "Ölçüm parametreleri ayarlanıyor...",
    "Bulmaca algoritmaları hazırlanıyor...",
    "Terminal arayüzü aktif ediliyor..."
];

let currentMessageIndex = 0;

function showNextLoadingMessage() {
    if (currentMessageIndex < loadingMessages.length) {
        const messageContainer = document.getElementById("loading-text-container");
        
        // Yeni bir <div> öğesi oluştur ve içine metni yaz
        const newMessage = document.createElement("div");
        newMessage.classList.add("loading-text");
        newMessage.textContent = loadingMessages[currentMessageIndex];
        messageContainer.appendChild(newMessage);
        
        currentMessageIndex++;

        // Bir sonraki mesajı 2 saniye sonra ekrana yazdır
        setTimeout(showNextLoadingMessage, 2000);
    }
}
        // Start loading animation
        function startIntro() {
    let progress = 0;
    showNextLoadingMessage(); // 🔥 Yükleme mesajlarını sırayla göstermek için fonksiyonu başlat

    const interval = setInterval(() => {
        progress += 1;
        loadingBar.style.width = `${progress}%`;

        if (progress >= 100) {
    clearInterval(interval);
    setTimeout(() => {
        // Yükleme ekranı kaybolmadan önce buton eklenecek
        const startButton = document.createElement("button");
        startButton.textContent = "▶ Hazırsanız Başlayalım";
        startButton.id = "startButton";
        
        // Butonun CSS özellikleri
        startButton.style.padding = "15px 30px";
        startButton.style.fontSize = "18px";
        startButton.style.border = "2px solid var(--terminal-green)";
        startButton.style.backgroundColor = "black";
        startButton.style.color = "var(--terminal-green)";
        startButton.style.cursor = "pointer";
        startButton.style.display = "block";
        startButton.style.margin = "20px auto";
        startButton.style.textAlign = "center";
        startButton.style.animation = "blinkEffect 1s infinite"; // Yanıp sönme animasyonu

        // Butonu intro-animation içine ekliyoruz
        document.getElementById("intro-animation").appendChild(startButton);

        // Kullanıcı tıkladığında buton kaybolacak ve sorular başlayacak
        startButton.addEventListener("click", () => {
            startButton.remove(); // Butonu kaldır
            introAnimation.style.display = 'none'; // Yükleme ekranını kaldır
            questionContainer.style.display = 'block'; // Soruları göster
            startGame(); // Oyunu başlat
        });

    }, 1000);
}
    }, 100); // 10 seconds total
}
        
        // Format time from seconds to MM:SS
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        }
        
        // Update the timer display
        function updateTimer() {
            timerElement.textContent = `SÜRE: ${formatTime(gameState.timeRemaining)}`;
            
            if (gameState.timeRemaining <= 0) {
                clearInterval(gameState.timer);
                // Add glitching effect when time runs out
                document.getElementById('terminal').classList.add('glitching');
                document.getElementById('terminal').setAttribute('data-text', document.getElementById('terminal').innerText);
                
                setTimeout(() => {
                    document.getElementById('terminal').classList.remove('glitching');
                    nextQuestion();
                }, 1000);
            }
            
            gameState.timeRemaining--;
        }
        
        // Update score display
        function updateScore() {
            scoreElement.textContent = `PUAN: ${gameState.score}`;
        }
        
        // Show the current question
        function showQuestion() {
            if (gameState.currentQuestion >= gameState.questions.length) {
                showResults();
                return;
            }
            
            const question = gameState.questions[gameState.currentQuestion];
            questionElement.textContent = question.question;
            
            // Clear previous options
            optionsElement.innerHTML = '';
            
            // Add options
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.classList.add('option');
                optionElement.textContent = option.text;
                optionElement.addEventListener('click', () => selectOption(index));
                optionsElement.appendChild(optionElement);
            });
            
            // Reset and start timer
            gameState.timeRemaining = 600; // 10 minutes
            updateTimer();
            clearInterval(gameState.timer);
            gameState.timer = setInterval(updateTimer, 1000);
            
            // Record start time for point calculation
            gameState.answerTime = Date.now();
        }
        
        // Handle option selection
        function selectOption(index) {
            const question = gameState.questions[gameState.currentQuestion];
            const option = question.options[index];
            const optionElements = document.querySelectorAll('.option');
            
            // Disable all options
            optionElements.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            // Calculate elapsed time in minutes
            const elapsedTime = (Date.now() - gameState.answerTime) / 1000 / 60;
            
// Eğer "Etkisi en az olacak şıkkı seçin?" sorusundaysak
const currentQuestion = gameState.questions[gameState.currentQuestion];

if (option.text === "Bu soruyu geç" && currentQuestion.question === "Etkisi en az olacak şıkkı seçin?") {
    optionElements[index].classList.add('correct'); // Doğru olarak işaretle
    
    // Zamana göre puan hesaplama
    const elapsedTime = (Date.now() - gameState.answerTime) / 1000 / 60;
    let pointsEarned = 0;

    if (elapsedTime <= 2) {
        pointsEarned = 10; // 2 dakika içinde cevaplandıysa
    } else if (elapsedTime <= 5) {
        pointsEarned = 8; // 2-5 dakika arasında cevaplandıysa
    } else {
        pointsEarned = 5; // 5 dakika sonrasında cevaplandıysa
    }

    gameState.score += pointsEarned; // Puan ekle
    updateScore();
    setTimeout(nextQuestion, 1000);
    return;
}

// Eğer bu özel soru değilse, eski mantıkla devam et
if (option.skip) {
    optionElements[index].classList.add('skip');
    setTimeout(nextQuestion, 1000);
    return;
}
            
            // Determine correct index using obfuscated answers
            const obf = obfAnswers[gameState.currentQuestion];
            const correctIndex = (typeof obf === 'number') ? (obf ^ _SALT) : null;

            if (correctIndex !== null && index === correctIndex) {
                optionElements[index].classList.add('correct');
                // Point calculation based on time
                let pointsEarned = 0;
                if (elapsedTime <= 2) {
                    pointsEarned = 10; // Full points if answered within 2 minutes
                } else if (elapsedTime <= 5) {
                    pointsEarned = 8; // 8 points if answered between 2-5 minutes
                } else {
                    pointsEarned = 5; // 5 points if answered after 5 minutes
                }
                gameState.score += pointsEarned;
            } else {
                optionElements[index].classList.add('incorrect');
                gameState.score -= 2; // Penalty for wrong answer
            }
            
            updateScore();
            setTimeout(nextQuestion, 1000);
        }
        
        // Move to the next question
        function nextQuestion() {
            gameState.currentQuestion++;
            clearInterval(gameState.timer);
            showQuestion();
        }
        
        // Show final results
        function showResults() {
            questionContainer.style.display = 'none';
            resultsElement.style.display = 'flex';
            finalScoreElement.textContent = gameState.score;
            clearInterval(gameState.timer);

            // Bitirme süresini hesapla
            gameState.endTime = Date.now();
            gameState.finishDuration = Math.max(0, Math.floor((gameState.endTime - gameState.startTime) / 1000)); // saniye

            // Skor girişi kutusunu göster
            document.getElementById('scoreboard-entry').style.display = 'block';
            document.getElementById('scoreboard').style.display = 'none';
            document.getElementById('player-initials').value = '';
            document.getElementById('player-initials').focus();
        }

        // Skor kaydetme ve tabloyu gösterme (gelişmiş kötü amaçlı isim filtresi içerir)
        document.getElementById('submit-score').onclick = function() {
            let initialsInput = document.getElementById('player-initials');
            let raw = initialsInput.value || '';

            // Normalize function: uppercase, map leet, replace Turkish chars to ASCII, remove non-letters
            function normalize(str) {
                const leet = { '4':'A','@':'A','0':'O','1':'I','!':'I','3':'E','5':'S','$':'S','7':'T' };
                str = str.toUpperCase();
                // replace leet
                str = str.split('').map(ch => leet[ch] || ch).join('');
                // replace Turkish diacritics to base letters
                str = str.replace(/[Ğg]/gi,'G').replace(/[Üu]/gi,'U').replace(/[Şs]/gi,'S').replace(/[İIıi]/gi,'I').replace(/[Öo]/gi,'O').replace(/[Çc]/gi,'C');
                // keep only A-Z
                str = str.replace(/[^A-Z]/g,'');
                // collapse repeated letters (e.g., PIIIC -> PIC)
                str = str.replace(/(.)\1+/g,'$1');
                return str;
            }

            const initials = normalize(raw).slice(0,3);

            // Genişletilmiş blacklist (ASCII normalize edilmiş kökler)
            const blacklist = [
                'AMK','AMQ','AQ','AM','SIK','SIQ','S1K','S!K',
                'OROSP','OROSPU','OROS','ORO','OC','OCU',
                'GOT','GOTU','GÖT','GOTU','PIC','PIÇ','PIQ','PIK',
                'GOT','GOTU','GÖT','PIÇ','PIQ','PIC',
                // kullanıcı tarafından istenen ek kelimeler
                'GOT','GOTU','GÖT','PIÇ','PIK','PIQ','NAH','NAHK','NAQ','BOK','B0K','ÇÜK','CUK','IT','YRK','YRK'
            ].map(s => normalize(s));

            // Final check: if normalized initials contains or equals any black token
            const isProfane = blacklist.some(b => b && (initials.includes(b) || b.includes(initials) || initials === b));

            if(isProfane) {
                // show overlay with actor
                const guard = document.getElementById('magic-guard');
                guard.style.display = 'flex';
                // 3s sonra gizle, temizle, odakla
                setTimeout(() => {
                    guard.style.display = 'none';
                    initialsInput.value = '';
                    initialsInput.focus();
                }, 3000);
                return;
            }

            if(initials.length !== 3) {
                initialsInput.style.borderColor = '#f00';
                return;
            }
            initialsInput.style.borderColor = '#08f';
            // Skoru localStorage'a ekle
            let scores = [];
            try {
                scores = JSON.parse(localStorage.getItem('cyberpunk_scores') || '[]');
            } catch(e) { scores = []; }
            // Süreyi dakika:saniye formatına çevir
            // Eğer finishDuration daha önce ayarlanmadıysa (beklenmeyen durum), hesapla
            let duration = typeof gameState.finishDuration === 'number' ? gameState.finishDuration : Math.max(0, Math.floor((Date.now() - (gameState.startTime || Date.now())) / 1000));
            let min = Math.floor(duration/60);
            let sec = duration%60;
            let durationStr = `${min.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
            scores.push({ name: initials, score: gameState.score, duration: durationStr });
            // En yüksekten en düşüğe sırala
            scores.sort((a,b) => b.score - a.score);
            // Sadece ilk 10 skoru tut
            scores = scores.slice(0,10);
            localStorage.setItem('cyberpunk_scores', JSON.stringify(scores));

            // Skor tablosunu doldur
            let tbody = '';
            scores.forEach(s => {
                tbody += `<tr style='font-size:1.2em;border-bottom:1px solid #222;'>
                    <td style='color:#0f8;padding:8px 24px 8px 8px;text-align:left;'>${s.name}</td>
                    <td style='color:#fff;padding:8px 24px;text-align:center;'>${s.score}</td>
                    <td style='color:#08f;padding:8px 24px 8px 8px;text-align:right;'>${s.duration}</td>
                </tr>`;
            });
            document.getElementById('scoreboard-body').innerHTML = tbody;
            document.getElementById('scoreboard').style.display = 'block';
            document.getElementById('scoreboard-entry').style.display = 'none';
        };
        
        // Start the game
        function startGame() {
            gameState.startTime = Date.now();
            updateScore();
            showQuestion();
        }
        
        // Initialize on load
        window.onload = startIntro;
    </script>
    <script>
    (function(){
        if('loading' in HTMLImageElement.prototype) return;
        const imgs = document.querySelectorAll('img');
        if('IntersectionObserver' in window){
            const io = new IntersectionObserver((entries, obs) => {
                entries.forEach(e => {
                    if(e.isIntersecting){
                        const img = e.target;
                        if(img.dataset.src) img.src = img.dataset.src;
                        obs.unobserve(img);
                    }
                });
            });
            imgs.forEach(img => {
                if(!img.hasAttribute('loading')) img.setAttribute('loading','lazy');
                if(img.src && !img.dataset.src){ img.dataset.src = img.src; img.removeAttribute('src'); }
                io.observe(img);
            });
        }
    })();
    </script>
</body>
</html>
